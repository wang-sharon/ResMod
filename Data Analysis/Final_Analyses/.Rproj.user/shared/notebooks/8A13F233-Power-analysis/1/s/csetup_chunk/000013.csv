"0","knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)"
"0","# Load necessary packages"
"0","library(MASS)  # For glm.nb()"
"0","library(dplyr) # For data handling"
"0",""
"0","# Set parameters"
"0","set.seed(123)"
"0","n_sim <- 1000    # Number of simulations per sample size"
"0","alpha <- 0.05    # Significance level"
"0","power_target <- 0.80  # Desired power"
"0",""
"0","# Start with a reasonable sample size"
"0","n <- 50  "
"0","power_estimate <- 0  "
"0",""
"0","# Define effect sizes (use small-moderate values)"
"0","beta_0 <- 1.0    "
"0","beta_1 <- 0.30   "
"0","beta_2 <- 0.30   "
"0","beta_3 <- 0.30   "
"0","beta_4 <- 0.15   "
"0","beta_5 <- 0.15   "
"0","beta_6 <- 0.15   "
"0","beta_7 <- 0.25   "
"0",""
"0","while (power_estimate < power_target) {"
"0","  sig_count <- 0  # Count significant results"
"0","  "
"0","  for (i in 1:n_sim) {"
"0","    # Generate predictor variables (normal distribution)"
"0","    X1 <- rnorm(n, mean = 0, sd = 1)"
"0","    X2 <- rnorm(n, mean = 0, sd = 1)"
"0","    X3 <- rnorm(n, mean = 0, sd = 1)"
"0","    "
"0","    # Compute log-mean for negative binomial"
"0","    log_mu <- beta_0 + beta_1*X1 + beta_2*X2 + beta_3*X3 + "
"0","      beta_4*(X1*X2) + beta_5*(X1*X3) + beta_6*(X2*X3) + "
"0","      beta_7*(X1*X2*X3)"
"0","    "
"0","    # Ensure no extreme values"
"0","    log_mu <- pmax(pmin(log_mu, 3), -3)  # Bound values between -5 and 5"
"0","    "
"0","    # Generate negative binomial outcome variable"
"0","    Y <- tryCatch({"
"0","      rnbinom(n, size = 10, mu = exp(log_mu))"
"0","    }, error = function(e) NA)  # Catch errors and return NA"
"0","    "
"0","    # Skip iteration if Y contains NAs"
"0","    if (any(is.na(Y))) next  "
"0","    "
"0","    # Fit negative binomial model"
"0","    model <- tryCatch({"
"0","      glm.nb(Y ~ X1 * X2 * X3, control = glm.control(maxit = 100))"
"0","    }, error = function(e) NULL)  "
"0","    "
"0","    # Skip if model didn't fit"
"0","    if (is.null(model)) next  "
"0","    "
"0","    # Check p-value for the three-way interaction"
"0","    p_value <- summary(model)$coefficients[""X1:X2:X3"", 4]"
"0","    "
"0","    # Count significant results"
"0","    if (!is.na(p_value) && p_value < alpha) {"
"0","      sig_count <- sig_count + 1"
"0","    }"
"0","  }"
"0","  "
"0","  # Compute power"
"0","  power_estimate <- sig_count / n_sim"
"0","  print(paste(""Sample size:"", n, ""Estimated Power:"", round(power_estimate, 3)))"
"0","  "
"0","  # Increase sample size if power is too low"
"0","  if (power_estimate < power_target) {"
"0","    n <- n + 10"
"0","  }"
"0","}"
"1","[1]"
"1"," ""Sample size: 50 Estimated Power: 0.295"""
"1","
"
"1","[1]"
"1"," ""Sample size: 60 Estimated Power: 0.371"""
"1","
"
"1","[1]"
"1"," ""Sample size: 70 Estimated Power: 0.452"""
"1","
"
"1","[1]"
"1"," ""Sample size: 80 Estimated Power: 0.49"""
"1","
"
"1","[1]"
"1"," ""Sample size: 90 Estimated Power: 0.57"""
"1","
"
"1","[1]"
"1"," ""Sample size: 100 Estimated Power: 0.607"""
"1","
"
"1","[1]"
"1"," ""Sample size: 110 Estimated Power: 0.622"""
"1","
"
"1","[1]"
"1"," ""Sample size: 120 Estimated Power: 0.648"""
"1","
"
"1","[1]"
"1"," ""Sample size: 130 Estimated Power: 0.714"""
"1","
"
"1","[1]"
"1"," ""Sample size: 140 Estimated Power: 0.714"""
"1","
"
"1","[1]"
"1"," ""Sample size: 150 Estimated Power: 0.771"""
"1","
"
"1","[1]"
"1"," ""Sample size: 160 Estimated Power: 0.788"""
"1","
"
"1","[1]"
"1"," ""Sample size: 170 Estimated Power: 0.795"""
"1","
"
"1","[1]"
"1"," ""Sample size: 180 Estimated Power: 0.822"""
"1","
"
"0","# Final result"
"0","print(paste(""Minimum required sample size for 80% power:"", n))"
"1","[1]"
"1"," ""Minimum required sample size for 80% power: 180"""
"1","
"
